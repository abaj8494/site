<ul>
  {{ $currentPage := . }}
  {{ $site := .Site }}
  {{ $path := .File.Dir }}

  <!-- Recursively collect paths to all parent directories -->
  {{ $paths := slice }}
  {{ range (split $path "/") }}
    {{ $paths = $paths | append (delimit (slice $paths | join "/") "/") }}
  {{ end }}

  <!-- Render each directory and its contents -->
  {{ range $parent := $paths }}
    {{ $parentSection := (where $site.Pages "File.Dir" $parent) }}
    <li>
      <strong>{{ path.Base $parent | humanize | title }}</strong> <!-- Display parent folder name -->
      <ul>
        {{ range $parentSection }}
          <li>
            <a href="{{ .RelPermalink }}"
               class="{{ if eq .RelPermalink $currentPage.RelPermalink }}current{{ end }}">
              {{ .Title }}
            </a>
          </li>
        {{ end }}
      </ul>
    </li>
  {{ end }}
</ul>
